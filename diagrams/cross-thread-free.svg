<svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" contentStyleType="text/css" data-diagram-type="SEQUENCE" height="562px" preserveAspectRatio="none" style="width:753px;height:562px;background:#F9F9F9;" version="1.1" viewBox="0 0 753 562" width="753px" zoomAndPan="magnify"><defs/><g><rect fill="#F9F9F9" height="562" style="stroke:transparent;stroke-width:1;" width="753" x="0" y="0"/><rect fill="transparent" height="88.3984" rx="3.5" ry="3.5" style="stroke:#393939;stroke-width:1;" width="400.0786" x="347.8535" y="371.1641"/><g><title>Thread B (sender)</title><rect fill="transparent" height="186.6641" width="8" x="71.3623" y="36.2969"/><line style="stroke:#393939;stroke-width:0.5;stroke-dasharray:5.0,5.0;" x1="75" x2="75" y1="36.2969" y2="222.9609"/></g><line style="stroke:#393939;stroke-width:1;stroke-dasharray:1.0,4.0;" x1="75" x2="75" y1="222.9609" y2="263.7656"/><g><title>Thread B (sender)</title><rect fill="transparent" height="263.0625" width="8" x="71.3623" y="263.7656"/><line style="stroke:#393939;stroke-width:0.5;stroke-dasharray:5.0,5.0;" x1="75" x2="75" y1="263.7656" y2="526.8281"/></g><g><title>SPSC Queue</title><rect fill="transparent" height="186.6641" width="8" x="253.0483" y="36.2969"/><line style="stroke:#393939;stroke-width:0.5;stroke-dasharray:5.0,5.0;" x1="256.8315" x2="256.8315" y1="36.2969" y2="222.9609"/></g><line style="stroke:#393939;stroke-width:1;stroke-dasharray:1.0,4.0;" x1="256.8315" x2="256.8315" y1="222.9609" y2="263.7656"/><g><title>SPSC Queue</title><rect fill="transparent" height="263.0625" width="8" x="253.0483" y="263.7656"/><line style="stroke:#393939;stroke-width:0.5;stroke-dasharray:5.0,5.0;" x1="256.8315" x2="256.8315" y1="263.7656" y2="526.8281"/></g><g><title>Thread A (owner)</title><rect fill="transparent" height="186.6641" width="8" x="421.813" y="36.2969"/><line style="stroke:#393939;stroke-width:0.5;stroke-dasharray:5.0,5.0;" x1="424.8535" x2="424.8535" y1="36.2969" y2="222.9609"/></g><line style="stroke:#393939;stroke-width:1;stroke-dasharray:1.0,4.0;" x1="424.8535" x2="424.8535" y1="222.9609" y2="263.7656"/><g><title>Thread A (owner)</title><rect fill="transparent" height="263.0625" width="8" x="421.813" y="263.7656"/><line style="stroke:#393939;stroke-width:0.5;stroke-dasharray:5.0,5.0;" x1="424.8535" x2="424.8535" y1="263.7656" y2="526.8281"/></g><g><title>Memory Manager A</title><rect fill="transparent" height="186.6641" width="8" x="614.21" y="36.2969"/><line style="stroke:#393939;stroke-width:0.5;stroke-dasharray:5.0,5.0;" x1="617.8198" x2="617.8198" y1="36.2969" y2="222.9609"/></g><line style="stroke:#393939;stroke-width:1;stroke-dasharray:1.0,4.0;" x1="617.8198" x2="617.8198" y1="222.9609" y2="263.7656"/><g><title>Memory Manager A</title><rect fill="transparent" height="263.0625" width="8" x="614.21" y="263.7656"/><line style="stroke:#393939;stroke-width:0.5;stroke-dasharray:5.0,5.0;" x1="617.8198" x2="617.8198" y1="263.7656" y2="526.8281"/></g><rect fill="#E55756" height="30.2969" rx="3.5" ry="3.5" style="stroke:#191919;stroke-width:1.5;" width="140.7246" x="5" y="5"/><text fill="#F9F9F9" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="126.7246" x="12" y="24.9951">Thread B (sender)</text><rect fill="#E55756" height="30.2969" rx="3.5" ry="3.5" style="stroke:#191919;stroke-width:1.5;" width="140.7246" x="5" y="525.8281"/><text fill="#F9F9F9" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="126.7246" x="12" y="545.8232">Thread B (sender)</text><rect fill="#E55756" height="30.2969" rx="3.5" ry="3.5" style="stroke:#191919;stroke-width:1.5;" width="100.4336" x="206.8315" y="5"/><text fill="#F9F9F9" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="86.4336" x="213.8315" y="24.9951">SPSC Queue</text><rect fill="#E55756" height="30.2969" rx="3.5" ry="3.5" style="stroke:#191919;stroke-width:1.5;" width="100.4336" x="206.8315" y="525.8281"/><text fill="#F9F9F9" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="86.4336" x="213.8315" y="545.8232">SPSC Queue</text><rect fill="#E55756" height="30.2969" rx="3.5" ry="3.5" style="stroke:#191919;stroke-width:1.5;" width="135.9189" x="357.8535" y="5"/><text fill="#F9F9F9" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="121.9189" x="364.8535" y="24.9951">Thread A (owner)</text><rect fill="#E55756" height="30.2969" rx="3.5" ry="3.5" style="stroke:#191919;stroke-width:1.5;" width="135.9189" x="357.8535" y="525.8281"/><text fill="#F9F9F9" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="121.9189" x="364.8535" y="545.8232">Thread A (owner)</text><rect fill="#E55756" height="30.2969" rx="3.5" ry="3.5" style="stroke:#191919;stroke-width:1.5;" width="150.7803" x="542.8198" y="5"/><text fill="#F9F9F9" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="136.7803" x="549.8198" y="24.9951">Memory Manager A</text><rect fill="#E55756" height="30.2969" rx="3.5" ry="3.5" style="stroke:#191919;stroke-width:1.5;" width="150.7803" x="542.8198" y="525.8281"/><text fill="#F9F9F9" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="136.7803" x="549.8198" y="545.8232">Memory Manager A</text><line style="stroke:#191919;stroke-width:1;" x1="75.3623" x2="117.3623" y1="67.4297" y2="67.4297"/><line style="stroke:#191919;stroke-width:1;" x1="117.3623" x2="117.3623" y1="67.4297" y2="80.4297"/><line style="stroke:#191919;stroke-width:1;" x1="76.3623" x2="117.3623" y1="80.4297" y2="80.4297"/><polygon fill="#191919" points="86.3623,76.4297,76.3623,80.4297,86.3623,84.4297,82.3623,80.4297" style="stroke:#191919;stroke-width:1;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="72.1475" x="82.3623" y="62.3638">efree($obj)</text><line style="stroke:#191919;stroke-width:1;" x1="75.3623" x2="117.3623" y1="109.5625" y2="109.5625"/><line style="stroke:#191919;stroke-width:1;" x1="117.3623" x2="117.3623" y1="109.5625" y2="122.5625"/><line style="stroke:#191919;stroke-width:1;" x1="76.3623" x2="117.3623" y1="122.5625" y2="122.5625"/><polygon fill="#191919" points="86.3623,118.5625,76.3623,122.5625,86.3623,126.5625,82.3623,122.5625" style="stroke:#191919;stroke-width:1;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="167.686" x="82.3623" y="104.4966">detect: owner is Thread A</text><polygon fill="#191919" points="245.0483,158.2617,255.0483,162.2617,245.0483,166.2617,249.0483,162.2617" style="stroke:#191919;stroke-width:1;"/><line style="stroke:#191919;stroke-width:1;" x1="75.3623" x2="251.0483" y1="162.2617" y2="162.2617"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="106.812" x="82.3623" y="157.1958">push(Object ptr)</text><path d="M262,139.0625 L262,172.0625 A3.5,3.5 0 0 0 265.5,175.5625 L410.5,175.5625 A3.5,3.5 0 0 0 414,172.0625 L414,145.5625 L404,135.5625 L265.5,135.5625 A3.5,3.5 0 0 0 262,139.0625 " fill="#E5E5E5" style="stroke:#191919;stroke-width:1.5;"/><path d="M404,135.5625 L404,143.8125 A1.75,1.75 0 0 0 405.75,145.5625 L414,145.5625 L404,135.5625 " fill="#E5E5E5" style="stroke:#191919;stroke-width:1.5;"/><text fill="#191919" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="127.0293" x="268" y="152.6294">Lock-free operation</text><text fill="#191919" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="131.3267" x="268" y="167.7622">(0 CAS on fast path)</text><line style="stroke:#191919;stroke-width:1;" x1="257.0483" x2="299.0483" y1="201.9609" y2="201.9609"/><line style="stroke:#191919;stroke-width:1;" x1="299.0483" x2="299.0483" y1="201.9609" y2="214.9609"/><line style="stroke:#191919;stroke-width:1;" x1="258.0483" x2="299.0483" y1="214.9609" y2="214.9609"/><polygon fill="#191919" points="268.0483,210.9609,258.0483,214.9609,268.0483,218.9609,264.0483,214.9609" style="stroke:#191919;stroke-width:1;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="95.7227" x="264.0483" y="196.895">store message</text><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="164.4146" x="264.5789" y="247.1714">Thread A continues execution</text><line style="stroke:#191919;stroke-width:1;" x1="425.813" x2="467.813" y1="284.8984" y2="284.8984"/><line style="stroke:#191919;stroke-width:1;" x1="467.813" x2="467.813" y1="284.8984" y2="297.8984"/><line style="stroke:#191919;stroke-width:1;" x1="426.813" x2="467.813" y1="297.8984" y2="297.8984"/><polygon fill="#191919" points="436.813,293.8984,426.813,297.8984,436.813,301.8984,432.813,297.8984" style="stroke:#191919;stroke-width:1;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="94.3643" x="432.813" y="279.8325">periodic check</text><polygon fill="#191919" points="268.0483,323.0313,258.0483,327.0313,268.0483,331.0313,264.0483,327.0313" style="stroke:#191919;stroke-width:1;"/><line style="stroke:#191919;stroke-width:1;" x1="262.0483" x2="424.813" y1="327.0313" y2="327.0313"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="130.5776" x="274.0483" y="321.9653">collect remote frees</text><polygon fill="#191919" points="413.813,352.1641,423.813,356.1641,413.813,360.1641,417.813,356.1641" style="stroke:#191919;stroke-width:1;"/><line style="stroke:#191919;stroke-width:1;" x1="257.0483" x2="419.813" y1="356.1641" y2="356.1641"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="144.7646" x="264.0483" y="351.0981">pop messages (batch)</text><path d="M351.3535,371.1641 L424.4775,371.1641 L424.4775,378.2969 L414.4775,388.2969 L347.8535,388.2969 L347.8535,374.6641 A3.5,3.5 0 0 1 351.3535,371.1641 " fill="#EEEEEE" style="stroke:#393939;stroke-width:1.5;"/><rect fill="transparent" height="88.3984" rx="3.5" ry="3.5" style="stroke:#393939;stroke-width:1;" width="400.0786" x="347.8535" y="371.1641"/><text fill="#191919" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="31.624" x="362.8535" y="384.231">loop</text><text fill="#393939" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacing" textLength="119.4907" x="439.4775" y="383.3745">[for each message]</text><polygon fill="#191919" points="606.21,405.4297,616.21,409.4297,606.21,413.4297,610.21,409.4297" style="stroke:#191919;stroke-width:1;"/><line style="stroke:#191919;stroke-width:1;" x1="425.813" x2="612.21" y1="409.4297" y2="409.4297"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="168.397" x="432.813" y="404.3638">free(ptr) in owner context</text><line style="stroke:#191919;stroke-width:1;" x1="618.21" x2="660.21" y1="438.5625" y2="438.5625"/><line style="stroke:#191919;stroke-width:1;" x1="660.21" x2="660.21" y1="438.5625" y2="451.5625"/><line style="stroke:#191919;stroke-width:1;" x1="619.21" x2="660.21" y1="451.5625" y2="451.5625"/><polygon fill="#191919" points="629.21,447.5625,619.21,451.5625,629.21,455.5625,625.21,451.5625" style="stroke:#191919;stroke-width:1;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="110.7222" x="625.21" y="433.4966">return to free list</text><path d="M356,475.0625 L356,508.0625 A3.5,3.5 0 0 0 359.5,511.5625 L682.5,511.5625 A3.5,3.5 0 0 0 686,508.0625 L686,481.5625 L676,471.5625 L359.5,471.5625 A3.5,3.5 0 0 0 356,475.0625 " fill="#E5E5E5" style="stroke:#191919;stroke-width:1.5;"/><path d="M676,471.5625 L676,479.8125 A1.75,1.75 0 0 0 677.75,481.5625 L686,481.5625 L676,471.5625 " fill="#E5E5E5" style="stroke:#191919;stroke-width:1.5;"/><text fill="#191919" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="133.9229" x="449.9119" y="488.6294">Memory safely freed</text><text fill="#191919" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="119.8564" x="449.9119" y="503.7622">in owner's context</text><!--SRC=[RP71Ri8m44Jl_eefgjH4AgXd3fKIhhLQH8-z66SXXk2DRAU5l-yw4AHApN4pysQy-v1QEX5E9aIbUXEIiwutFc7ssGOo3MeKaNn3ePp1HDH_HPkFpGhhWGOQ_wx_HLGe-CTFXEglHjE9mmNQUBEdW6hKQArKZVahwYLe5uYAHzuUolkieKGsBJ5YuIAcf9jjlKG_nBPutnv4Xpw5KdbEXE3shVZUs1xdcGlkAPZas7_vuWMhQWFss9ae9fFQKgdrZHSJ1zaJnIWzbLei5lTGMFR9-O4Yw4nso3Y8GAagcoifGy5nuoniI_Pu7GlJSjVbVa5s8ELoeNWDp1xkfxY8OckIpNKwbl6E0yZOzbu7yerGhPSZfiXFXlEt3UM2T4wZJkj962WDmIFnQ47dOb9oQdLT5N_dSppBASHpFL8qE-ekexgHwOH_YlS0iIExrIy0]--></g></svg>